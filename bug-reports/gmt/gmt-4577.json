{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "Currently, PyGMT opens virtual files using `GMT_IN|GMT_IS_REFERENCE`, and the following script works well:\r\n\r\n```\r\nimport pygmt\r\ngrid = pygmt.datasets.load_earth_relief()\r\nsmooth_field = pygmt.grdfilter(grid=grid, filter=\"g600\", distance=\"4\")\r\n```\r\n\r\nHowever, if PyGMT uses `GMT_IN`, the above script crashes:\r\n```\r\ngrdfilter [ERROR]: G->data is not NULL when memory allocation is about to happen\r\n[Session pygmt-session (3)]: Error returned from GMT API: GMT_PTR_IS_NULL (75)\r\n[Session pygmt-session (3)]: Error returned from GMT API: GMT_PTR_IS_NULL (75)\r\n[Session pygmt-session (3)]: Error returned from GMT API: GMT_OBJECT_NOT_FOUND (60)\r\n\r\n...\r\n\r\nGMTCLibError: Failed to close virtual file '@GMTAPI@-S-I-G-M-G-N-000000'.\r\n```\r\n\r\nTo reproduce the issue, please update your pygmt repository, checkout this PR (https://github.com/GenericMappingTools/pygmt/pull/517), and run the above script.\r\n\r\nIt crashes with GMT 6.1.1 and GMT master, but it might work for old versions.",
    "closed_at": "2020-12-20T05:34:49Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/3974108?v=4",
        "events_url": "https://api.github.com/users/seisman/events{/privacy}",
        "followers_url": "https://api.github.com/users/seisman/followers",
        "following_url": "https://api.github.com/users/seisman/following{/other_user}",
        "gists_url": "https://api.github.com/users/seisman/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/seisman",
        "id": 3974108,
        "login": "seisman",
        "node_id": "MDQ6VXNlcjM5NzQxMDg=",
        "organizations_url": "https://api.github.com/users/seisman/orgs",
        "received_events_url": "https://api.github.com/users/seisman/received_events",
        "repos_url": "https://api.github.com/users/seisman/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/seisman/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/seisman/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/seisman"
    },
    "comments": 5,
    "comments_content": [
        {
            "author_association": "MEMBER",
            "body": "That I do PyGMT debugging (too) infrequently is perhaps good since it clearly points out lack of clear instructions on our debug page...  These are the steps I took (I already had pygmt checked out from the repo before):\r\n\r\n1. I pulled the latest to get all updates since last pull, then switched to the gmt-in branch.\r\n2. I ran conda activate pygmt\r\n3. I did `export GMT_SHAREDIR=/Users/pwessel/GMTdev/gmt-dev/dbuild `so that it points to a dir with share in it.\r\n4. I already had **GMT_LIBRARY_PATH** set to point to the xcode-built library /Users/pwessel/GMTdev/gmt-dev/xbuild/src/Debug\r\n5. I start python in the terminal\r\n6. I attach Xcode to the python process\r\n7. I set a stop point in _GMT_Call_Module_\r\n8. I copy/paste the three lines in the script above, one by one.\r\n\r\nIt reproduces the crash but did not stop in Xcode.  Am I missing a \"build or install\" type step for pyGMT above?\r\n",
            "created_at": "2020-12-19T19:43:46Z",
            "html_url": "https://github.com/GenericMappingTools/gmt/issues/4577#issuecomment-748516614",
            "id": 748516614,
            "issue_url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/4577",
            "node_id": "MDEyOklzc3VlQ29tbWVudDc0ODUxNjYxNA==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/comments/748516614/reactions"
            },
            "updated_at": "2020-12-19T19:43:46Z",
            "url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/comments/748516614",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/26473567?v=4",
                "events_url": "https://api.github.com/users/PaulWessel/events{/privacy}",
                "followers_url": "https://api.github.com/users/PaulWessel/followers",
                "following_url": "https://api.github.com/users/PaulWessel/following{/other_user}",
                "gists_url": "https://api.github.com/users/PaulWessel/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/PaulWessel",
                "id": 26473567,
                "login": "PaulWessel",
                "node_id": "MDQ6VXNlcjI2NDczNTY3",
                "organizations_url": "https://api.github.com/users/PaulWessel/orgs",
                "received_events_url": "https://api.github.com/users/PaulWessel/received_events",
                "repos_url": "https://api.github.com/users/PaulWessel/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/PaulWessel/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/PaulWessel/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/PaulWessel"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "I don't see anything wrong.",
            "created_at": "2020-12-19T19:53:31Z",
            "html_url": "https://github.com/GenericMappingTools/gmt/issues/4577#issuecomment-748517602",
            "id": 748517602,
            "issue_url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/4577",
            "node_id": "MDEyOklzc3VlQ29tbWVudDc0ODUxNzYwMg==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/comments/748517602/reactions"
            },
            "updated_at": "2020-12-19T19:53:31Z",
            "url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/comments/748517602",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/3974108?v=4",
                "events_url": "https://api.github.com/users/seisman/events{/privacy}",
                "followers_url": "https://api.github.com/users/seisman/followers",
                "following_url": "https://api.github.com/users/seisman/following{/other_user}",
                "gists_url": "https://api.github.com/users/seisman/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/seisman",
                "id": 3974108,
                "login": "seisman",
                "node_id": "MDQ6VXNlcjM5NzQxMDg=",
                "organizations_url": "https://api.github.com/users/seisman/orgs",
                "received_events_url": "https://api.github.com/users/seisman/received_events",
                "repos_url": "https://api.github.com/users/seisman/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/seisman/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/seisman/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/seisman"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "OK, will rebuild the xcode debug and start from the top.",
            "created_at": "2020-12-19T19:57:07Z",
            "html_url": "https://github.com/GenericMappingTools/gmt/issues/4577#issuecomment-748518022",
            "id": 748518022,
            "issue_url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/4577",
            "node_id": "MDEyOklzc3VlQ29tbWVudDc0ODUxODAyMg==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/comments/748518022/reactions"
            },
            "updated_at": "2020-12-19T19:57:07Z",
            "url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/comments/748518022",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/26473567?v=4",
                "events_url": "https://api.github.com/users/PaulWessel/events{/privacy}",
                "followers_url": "https://api.github.com/users/PaulWessel/followers",
                "following_url": "https://api.github.com/users/PaulWessel/following{/other_user}",
                "gists_url": "https://api.github.com/users/PaulWessel/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/PaulWessel",
                "id": 26473567,
                "login": "PaulWessel",
                "node_id": "MDQ6VXNlcjI2NDczNTY3",
                "organizations_url": "https://api.github.com/users/PaulWessel/orgs",
                "received_events_url": "https://api.github.com/users/PaulWessel/received_events",
                "repos_url": "https://api.github.com/users/PaulWessel/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/PaulWessel/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/PaulWessel/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/PaulWessel"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "OK, I rebuilt but also selected target libgmt in Xcode and stop point in GMT_Call_Module.  That is probably better since gmt.c is not involved.\r\nGMT_Read_Data gets to the case GMT_IS_DUPLICATE|GMT_VIA_MATRIX and not GMT_IS_REFERENCE.  So not sure where it switches since you said this branch passes GMT_IN.  \r\nAnyway, looks like we call GMT_Create_Data for the grid to allocate memory for data and then later complain taht data is allocated.  Seems like a simple fix - will apply and check.",
            "created_at": "2020-12-19T20:23:11Z",
            "html_url": "https://github.com/GenericMappingTools/gmt/issues/4577#issuecomment-748520603",
            "id": 748520603,
            "issue_url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/4577",
            "node_id": "MDEyOklzc3VlQ29tbWVudDc0ODUyMDYwMw==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/comments/748520603/reactions"
            },
            "updated_at": "2020-12-19T20:23:11Z",
            "url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/comments/748520603",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/26473567?v=4",
                "events_url": "https://api.github.com/users/PaulWessel/events{/privacy}",
                "followers_url": "https://api.github.com/users/PaulWessel/followers",
                "following_url": "https://api.github.com/users/PaulWessel/following{/other_user}",
                "gists_url": "https://api.github.com/users/PaulWessel/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/PaulWessel",
                "id": 26473567,
                "login": "PaulWessel",
                "node_id": "MDQ6VXNlcjI2NDczNTY3",
                "organizations_url": "https://api.github.com/users/PaulWessel/orgs",
                "received_events_url": "https://api.github.com/users/PaulWessel/received_events",
                "repos_url": "https://api.github.com/users/PaulWessel/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/PaulWessel/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/PaulWessel/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/PaulWessel"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Hm, after passing mode = **GMT_CONTAINER_ONLY** to _GMT_Create_Data_ for the grid, the grid still has a non-zero data pointer.  OK, so need to go deeper.",
            "created_at": "2020-12-19T20:31:41Z",
            "html_url": "https://github.com/GenericMappingTools/gmt/issues/4577#issuecomment-748521431",
            "id": 748521431,
            "issue_url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/4577",
            "node_id": "MDEyOklzc3VlQ29tbWVudDc0ODUyMTQzMQ==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/comments/748521431/reactions"
            },
            "updated_at": "2020-12-19T20:31:41Z",
            "url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/comments/748521431",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/26473567?v=4",
                "events_url": "https://api.github.com/users/PaulWessel/events{/privacy}",
                "followers_url": "https://api.github.com/users/PaulWessel/followers",
                "following_url": "https://api.github.com/users/PaulWessel/following{/other_user}",
                "gists_url": "https://api.github.com/users/PaulWessel/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/PaulWessel",
                "id": 26473567,
                "login": "PaulWessel",
                "node_id": "MDQ6VXNlcjI2NDczNTY3",
                "organizations_url": "https://api.github.com/users/PaulWessel/orgs",
                "received_events_url": "https://api.github.com/users/PaulWessel/received_events",
                "repos_url": "https://api.github.com/users/PaulWessel/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/PaulWessel/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/PaulWessel/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/PaulWessel"
            }
        }
    ],
    "comments_url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/4577/comments",
    "created_at": "2020-12-16T02:13:51Z",
    "events_url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/4577/events",
    "html_url": "https://github.com/GenericMappingTools/gmt/issues/4577",
    "id": 768384125,
    "labels": [
        {
            "color": "d73a4a",
            "default": true,
            "description": "Something isn't working",
            "id": 1022239695,
            "name": "bug",
            "node_id": "MDU6TGFiZWwxMDIyMjM5Njk1",
            "url": "https://api.github.com/repos/GenericMappingTools/gmt/labels/bug"
        }
    ],
    "labels_url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/4577/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "MDU6SXNzdWU3NjgzODQxMjU=",
    "number": 4577,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/4577/reactions"
    },
    "repository_url": "https://api.github.com/repos/GenericMappingTools/gmt",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/4577/timeline",
    "title": "grdfilter crashes in pygmt if GMT_IN is used ",
    "updated_at": "2020-12-20T05:34:49Z",
    "url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/4577",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/3974108?v=4",
        "events_url": "https://api.github.com/users/seisman/events{/privacy}",
        "followers_url": "https://api.github.com/users/seisman/followers",
        "following_url": "https://api.github.com/users/seisman/following{/other_user}",
        "gists_url": "https://api.github.com/users/seisman/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/seisman",
        "id": 3974108,
        "login": "seisman",
        "node_id": "MDQ6VXNlcjM5NzQxMDg=",
        "organizations_url": "https://api.github.com/users/seisman/orgs",
        "received_events_url": "https://api.github.com/users/seisman/received_events",
        "repos_url": "https://api.github.com/users/seisman/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/seisman/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/seisman/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/seisman"
    }
}