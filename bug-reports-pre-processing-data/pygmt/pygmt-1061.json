{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "MEMBER",
    "body": "**Description of the problem**\r\n\r\nHere is a simple Python script to reproduce the issue. \r\n```python\r\nimport pygmt\r\n\r\nfig = pygmt.Figure()\r\nfig.basemap(region=[0, 10, 0, 10], projection=\"X10c/10c\", frame=\"+tFigure1\")\r\nprint(\"Openning Figure1\")\r\nfig.show(method=\"external\")\r\n```\r\nWhen I run the codes in a Python/IPython interpreter, it works well and can open the preview image. However, if I save it in a Python script and run it using `python test.py`, sometimes it can open the image but sometimes it fails and gives an error like (I'm using macOS):\r\n\r\n![image](https://user-images.githubusercontent.com/3974108/111100070-4bf7aa00-851d-11eb-808d-0a341e1a0a19.png)\r\n\r\nThe reason is simple, on macOS, we call the `open` program to open the image. Because we can't detect the status of the external viewer, the Python script continues to execute the code and exit. When the script exits, Python will call the destructor of the Figure class (i.e., `Figure.__del__` method), which deletes the preview directory and also the preview image.\r\n\r\nSo, the preview image will show if the `open` program opens the image before Python deletes it, and will fail to open the image if it's already deleted.\r\n\r\n---\r\n\r\nThe following script is similar to the above one, but instead, it plots and opens two images.\r\n```\r\nimport pygmt\r\n\r\nfig = pygmt.Figure()\r\nfig.basemap(region=[0, 10, 0, 10], projection=\"X10c/10c\", frame=\"+tFigure1\")\r\nprint(\"Openning Figure1\")\r\nfig.show(method=\"external\")\r\n\r\nfig = pygmt.Figure()\r\nfig.basemap(region=[0, 10, 0, 10], projection=\"X10c/10c\", frame=\"+tFigure2\")\r\nprint(\"Openning Figure2\")\r\nfig.show(method=\"external\")\r\n``` \r\n\r\nAgain, the script works well in a Python/IPython interpreter, but usually can open Figure1 and can't open Figure2 when running a script. Figure1 can be successfully opened because plotting the second figure take some time, so the first `Figure.show()` call can open Figure1 before the program exits.\r\n\r\n---\r\n\r\nThe only solution I can figure out is adding a short pause after calling the external viewer, i.e., \r\nadding `time.sleep(0.5)` at the end of the `launch_external_viewer(fname)` function.\r\n\r\nhttps://github.com/GenericMappingTools/pygmt/blob/1fb9e2e4e523baaf3aaedb90d71872ede6d03bb7/pygmt/helpers/utils.py#L195\r\n\r\nIt works well for me, and should also work for Linux, but I'm not sure about Windows. The 0.5 second pause time is empirical, and may not work for slow computers.\r\n\r\nI opened the PR #1062 with the above solution, so that anyone can test it with/without the pause.",
    "closed_at": "2021-11-22T00:31:41Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/3974108?v=4",
        "events_url": "https://api.github.com/users/seisman/events{/privacy}",
        "followers_url": "https://api.github.com/users/seisman/followers",
        "following_url": "https://api.github.com/users/seisman/following{/other_user}",
        "gists_url": "https://api.github.com/users/seisman/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/seisman",
        "id": 3974108,
        "login": "seisman",
        "node_id": "MDQ6VXNlcjM5NzQxMDg=",
        "organizations_url": "https://api.github.com/users/seisman/orgs",
        "received_events_url": "https://api.github.com/users/seisman/received_events",
        "repos_url": "https://api.github.com/users/seisman/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/seisman/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/seisman/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/seisman"
    },
    "comments": 5,
    "comments_content": [
        {
            "author_association": "MEMBER",
            "body": "I use CentOS 7.5 to test. Both two examples work in JupyterLab no matter if `time.sleep(0.5)` is added.\r\n\r\nHowever, it shows the same bug as @seisman when running a script (I tried three times for each cases).\r\n- The first example (only Figure 1) does not work and shows the same bug, but it works if `time.sleep(0.5)` is added.\r\n- The second example (two figures) can display Figure 1 but cannot open Figure 2, but it works if `time.sleep(0.5)` is added .\r\n",
            "created_at": "2021-03-15T06:45:16Z",
            "html_url": "https://github.com/GenericMappingTools/pygmt/issues/1061#issuecomment-799159764",
            "id": 799159764,
            "issue_url": "https://api.github.com/repos/GenericMappingTools/pygmt/issues/1061",
            "node_id": "MDEyOklzc3VlQ29tbWVudDc5OTE1OTc2NA==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/GenericMappingTools/pygmt/issues/comments/799159764/reactions"
            },
            "updated_at": "2021-03-15T06:45:16Z",
            "url": "https://api.github.com/repos/GenericMappingTools/pygmt/issues/comments/799159764",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/50591376?v=4",
                "events_url": "https://api.github.com/users/core-man/events{/privacy}",
                "followers_url": "https://api.github.com/users/core-man/followers",
                "following_url": "https://api.github.com/users/core-man/following{/other_user}",
                "gists_url": "https://api.github.com/users/core-man/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/core-man",
                "id": 50591376,
                "login": "core-man",
                "node_id": "MDQ6VXNlcjUwNTkxMzc2",
                "organizations_url": "https://api.github.com/users/core-man/orgs",
                "received_events_url": "https://api.github.com/users/core-man/received_events",
                "repos_url": "https://api.github.com/users/core-man/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/core-man/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/core-man/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/core-man"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "The issue is partially fixed by #1062, but I'll leave the issue open for a longer time.",
            "created_at": "2021-04-06T18:01:20Z",
            "html_url": "https://github.com/GenericMappingTools/pygmt/issues/1061#issuecomment-814324791",
            "id": 814324791,
            "issue_url": "https://api.github.com/repos/GenericMappingTools/pygmt/issues/1061",
            "node_id": "MDEyOklzc3VlQ29tbWVudDgxNDMyNDc5MQ==",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/GenericMappingTools/pygmt/issues/comments/814324791/reactions"
            },
            "updated_at": "2021-04-07T16:10:21Z",
            "url": "https://api.github.com/repos/GenericMappingTools/pygmt/issues/comments/814324791",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/3974108?v=4",
                "events_url": "https://api.github.com/users/seisman/events{/privacy}",
                "followers_url": "https://api.github.com/users/seisman/followers",
                "following_url": "https://api.github.com/users/seisman/following{/other_user}",
                "gists_url": "https://api.github.com/users/seisman/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/seisman",
                "id": 3974108,
                "login": "seisman",
                "node_id": "MDQ6VXNlcjM5NzQxMDg=",
                "organizations_url": "https://api.github.com/users/seisman/orgs",
                "received_events_url": "https://api.github.com/users/seisman/received_events",
                "repos_url": "https://api.github.com/users/seisman/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/seisman/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/seisman/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/seisman"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Do we want to keep this issue open @seisman? Or can we close it since `time.sleep(0.5)` seems to be good enough for most cases.",
            "created_at": "2021-11-03T23:28:01Z",
            "html_url": "https://github.com/GenericMappingTools/pygmt/issues/1061#issuecomment-960292084",
            "id": 960292084,
            "issue_url": "https://api.github.com/repos/GenericMappingTools/pygmt/issues/1061",
            "node_id": "IC_kwDOBRZfO845POT0",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/GenericMappingTools/pygmt/issues/comments/960292084/reactions"
            },
            "updated_at": "2021-11-03T23:28:01Z",
            "url": "https://api.github.com/repos/GenericMappingTools/pygmt/issues/comments/960292084",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/23487320?v=4",
                "events_url": "https://api.github.com/users/weiji14/events{/privacy}",
                "followers_url": "https://api.github.com/users/weiji14/followers",
                "following_url": "https://api.github.com/users/weiji14/following{/other_user}",
                "gists_url": "https://api.github.com/users/weiji14/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/weiji14",
                "id": 23487320,
                "login": "weiji14",
                "node_id": "MDQ6VXNlcjIzNDg3MzIw",
                "organizations_url": "https://api.github.com/users/weiji14/orgs",
                "received_events_url": "https://api.github.com/users/weiji14/received_events",
                "repos_url": "https://api.github.com/users/weiji14/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/weiji14/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/weiji14/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/weiji14"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Or can we close it since `time.sleep(0.5)` seems to be good enough for most cases.\r\n\r\nAt least one user reported to me that `time.sleep(0.5)` still doesn't work for him, possibly because his computer is old and slow. He has to change it to something like `time.sleep(1.0)` to make it work.\r\n\r\nPerhaps we should add a parameter like `sleep=0.5` to the `Figure.show()` function (and `launch_external_viewer`) so that users can customize the waiting time.\r\n",
            "created_at": "2021-11-04T01:52:41Z",
            "html_url": "https://github.com/GenericMappingTools/pygmt/issues/1061#issuecomment-960369272",
            "id": 960369272,
            "issue_url": "https://api.github.com/repos/GenericMappingTools/pygmt/issues/1061",
            "node_id": "IC_kwDOBRZfO845PhJ4",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/GenericMappingTools/pygmt/issues/comments/960369272/reactions"
            },
            "updated_at": "2021-11-04T01:52:41Z",
            "url": "https://api.github.com/repos/GenericMappingTools/pygmt/issues/comments/960369272",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/3974108?v=4",
                "events_url": "https://api.github.com/users/seisman/events{/privacy}",
                "followers_url": "https://api.github.com/users/seisman/followers",
                "following_url": "https://api.github.com/users/seisman/following{/other_user}",
                "gists_url": "https://api.github.com/users/seisman/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/seisman",
                "id": 3974108,
                "login": "seisman",
                "node_id": "MDQ6VXNlcjM5NzQxMDg=",
                "organizations_url": "https://api.github.com/users/seisman/orgs",
                "received_events_url": "https://api.github.com/users/seisman/received_events",
                "repos_url": "https://api.github.com/users/seisman/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/seisman/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/seisman/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/seisman"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "> Perhaps we should add a parameter like `sleep=0.5` to the `Figure.show()` function (and `launch_external_viewer`) so that users can customize the waiting time.\r\n\r\nYep, that sounds like a good option. Will need to modify these parts:\r\n\r\nhttps://github.com/GenericMappingTools/pygmt/blob/bafb8ab906aa87eb1dab3ce286b9baa91e145099/pygmt/helpers/utils.py#L256\r\nhttps://github.com/GenericMappingTools/pygmt/blob/bafb8ab906aa87eb1dab3ce286b9baa91e145099/pygmt/figure.py#L332\r\nhttps://github.com/GenericMappingTools/pygmt/blob/bafb8ab906aa87eb1dab3ce286b9baa91e145099/pygmt/figure.py#L265",
            "created_at": "2021-11-04T02:05:25Z",
            "html_url": "https://github.com/GenericMappingTools/pygmt/issues/1061#issuecomment-960374177",
            "id": 960374177,
            "issue_url": "https://api.github.com/repos/GenericMappingTools/pygmt/issues/1061",
            "node_id": "IC_kwDOBRZfO845PiWh",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/GenericMappingTools/pygmt/issues/comments/960374177/reactions"
            },
            "updated_at": "2021-11-04T02:05:25Z",
            "url": "https://api.github.com/repos/GenericMappingTools/pygmt/issues/comments/960374177",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/23487320?v=4",
                "events_url": "https://api.github.com/users/weiji14/events{/privacy}",
                "followers_url": "https://api.github.com/users/weiji14/followers",
                "following_url": "https://api.github.com/users/weiji14/following{/other_user}",
                "gists_url": "https://api.github.com/users/weiji14/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/weiji14",
                "id": 23487320,
                "login": "weiji14",
                "node_id": "MDQ6VXNlcjIzNDg3MzIw",
                "organizations_url": "https://api.github.com/users/weiji14/orgs",
                "received_events_url": "https://api.github.com/users/weiji14/received_events",
                "repos_url": "https://api.github.com/users/weiji14/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/weiji14/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/weiji14/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/weiji14"
            }
        }
    ],
    "comments_url": "https://api.github.com/repos/GenericMappingTools/pygmt/issues/1061/comments",
    "created_at": "2021-03-15T03:57:02Z",
    "events_url": "https://api.github.com/repos/GenericMappingTools/pygmt/issues/1061/events",
    "html_url": "https://github.com/GenericMappingTools/pygmt/issues/1061",
    "id": 831383789,
    "labels": [
        {
            "color": "ee0701",
            "default": true,
            "description": "Something isn't working",
            "id": 563309827,
            "name": "bug",
            "node_id": "MDU6TGFiZWw1NjMzMDk4Mjc=",
            "url": "https://api.github.com/repos/GenericMappingTools/pygmt/labels/bug"
        },
        {
            "color": "0e8a16",
            "default": true,
            "description": "Helping hands are appreciated",
            "id": 729911674,
            "name": "help wanted",
            "node_id": "MDU6TGFiZWw3Mjk5MTE2NzQ=",
            "url": "https://api.github.com/repos/GenericMappingTools/pygmt/labels/help%20wanted"
        }
    ],
    "labels_url": "https://api.github.com/repos/GenericMappingTools/pygmt/issues/1061/labels{/name}",
    "locked": false,
    "milestone": {
        "closed_at": "2022-03-15T23:17:52Z",
        "closed_issues": 174,
        "created_at": "2021-06-23T03:22:20Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/3974108?v=4",
            "events_url": "https://api.github.com/users/seisman/events{/privacy}",
            "followers_url": "https://api.github.com/users/seisman/followers",
            "following_url": "https://api.github.com/users/seisman/following{/other_user}",
            "gists_url": "https://api.github.com/users/seisman/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/seisman",
            "id": 3974108,
            "login": "seisman",
            "node_id": "MDQ6VXNlcjM5NzQxMDg=",
            "organizations_url": "https://api.github.com/users/seisman/orgs",
            "received_events_url": "https://api.github.com/users/seisman/received_events",
            "repos_url": "https://api.github.com/users/seisman/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/seisman/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/seisman/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/seisman"
        },
        "description": "",
        "due_on": null,
        "html_url": "https://github.com/GenericMappingTools/pygmt/milestone/9",
        "id": 6880166,
        "labels_url": "https://api.github.com/repos/GenericMappingTools/pygmt/milestones/9/labels",
        "node_id": "MDk6TWlsZXN0b25lNjg4MDE2Ng==",
        "number": 9,
        "open_issues": 0,
        "state": "closed",
        "title": "0.6.0",
        "updated_at": "2022-03-15T23:17:52Z",
        "url": "https://api.github.com/repos/GenericMappingTools/pygmt/milestones/9"
    },
    "node_id": "MDU6SXNzdWU4MzEzODM3ODk=",
    "number": 1061,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/GenericMappingTools/pygmt/issues/1061/reactions"
    },
    "repository_url": "https://api.github.com/repos/GenericMappingTools/pygmt",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/GenericMappingTools/pygmt/issues/1061/timeline",
    "title": "Fail to open images in external viewer programs if running PyGMT in a Python script",
    "updated_at": "2021-11-22T00:31:41Z",
    "url": "https://api.github.com/repos/GenericMappingTools/pygmt/issues/1061",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/3974108?v=4",
        "events_url": "https://api.github.com/users/seisman/events{/privacy}",
        "followers_url": "https://api.github.com/users/seisman/followers",
        "following_url": "https://api.github.com/users/seisman/following{/other_user}",
        "gists_url": "https://api.github.com/users/seisman/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/seisman",
        "id": 3974108,
        "login": "seisman",
        "node_id": "MDQ6VXNlcjM5NzQxMDg=",
        "organizations_url": "https://api.github.com/users/seisman/orgs",
        "received_events_url": "https://api.github.com/users/seisman/received_events",
        "repos_url": "https://api.github.com/users/seisman/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/seisman/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/seisman/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/seisman"
    }
}