{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "COLLABORATOR",
    "body": "# Description\r\nSee below a list of runs where it failed.\r\n* https://github.com/BlueBrain/Search/actions/runs/1687864091/attempts/1\r\n* https://github.com/BlueBrain/Search/actions/runs/1678055422\r\n\r\nUnfortunately, it seems to be random and most of the time it passes.",
    "closed_at": "2022-01-17T12:04:51Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/18519371?v=4",
        "events_url": "https://api.github.com/users/jankrepl/events{/privacy}",
        "followers_url": "https://api.github.com/users/jankrepl/followers",
        "following_url": "https://api.github.com/users/jankrepl/following{/other_user}",
        "gists_url": "https://api.github.com/users/jankrepl/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/jankrepl",
        "id": 18519371,
        "login": "jankrepl",
        "node_id": "MDQ6VXNlcjE4NTE5Mzcx",
        "organizations_url": "https://api.github.com/users/jankrepl/orgs",
        "received_events_url": "https://api.github.com/users/jankrepl/received_events",
        "repos_url": "https://api.github.com/users/jankrepl/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/jankrepl/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jankrepl/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/jankrepl"
    },
    "comments": 5,
    "comments_content": [
        {
            "author_association": "COLLABORATOR",
            "body": "Just brainstorming: We have seen random test fails in the CI before and the reason was out of memory issues.\r\n\r\nLooking at the logs, it seems to happen when we run the container and just wait for it to be ready.",
            "created_at": "2022-01-12T16:37:03Z",
            "html_url": "https://github.com/BlueBrain/Search/issues/547#issuecomment-1011236488",
            "id": 1011236488,
            "issue_url": "https://api.github.com/repos/BlueBrain/Search/issues/547",
            "node_id": "IC_kwDODu5QYM48Rj6I",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/BlueBrain/Search/issues/comments/1011236488/reactions"
            },
            "updated_at": "2022-01-12T16:40:53Z",
            "url": "https://api.github.com/repos/BlueBrain/Search/issues/comments/1011236488",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/18519371?v=4",
                "events_url": "https://api.github.com/users/jankrepl/events{/privacy}",
                "followers_url": "https://api.github.com/users/jankrepl/followers",
                "following_url": "https://api.github.com/users/jankrepl/following{/other_user}",
                "gists_url": "https://api.github.com/users/jankrepl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jankrepl",
                "id": 18519371,
                "login": "jankrepl",
                "node_id": "MDQ6VXNlcjE4NTE5Mzcx",
                "organizations_url": "https://api.github.com/users/jankrepl/orgs",
                "received_events_url": "https://api.github.com/users/jankrepl/received_events",
                "repos_url": "https://api.github.com/users/jankrepl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jankrepl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jankrepl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jankrepl"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "With out of memory the CI got killed instantly. These ones actually run to the end, so I suspect it might be something different.",
            "created_at": "2022-01-12T17:02:14Z",
            "html_url": "https://github.com/BlueBrain/Search/issues/547#issuecomment-1011260700",
            "id": 1011260700,
            "issue_url": "https://api.github.com/repos/BlueBrain/Search/issues/547",
            "node_id": "IC_kwDODu5QYM48Rp0c",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 1,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 1,
                "url": "https://api.github.com/repos/BlueBrain/Search/issues/comments/1011260700/reactions"
            },
            "updated_at": "2022-01-12T17:02:14Z",
            "url": "https://api.github.com/repos/BlueBrain/Search/issues/comments/1011260700",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8017698?v=4",
                "events_url": "https://api.github.com/users/Stannislav/events{/privacy}",
                "followers_url": "https://api.github.com/users/Stannislav/followers",
                "following_url": "https://api.github.com/users/Stannislav/following{/other_user}",
                "gists_url": "https://api.github.com/users/Stannislav/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Stannislav",
                "id": 8017698,
                "login": "Stannislav",
                "node_id": "MDQ6VXNlcjgwMTc2OTg=",
                "organizations_url": "https://api.github.com/users/Stannislav/orgs",
                "received_events_url": "https://api.github.com/users/Stannislav/received_events",
                "repos_url": "https://api.github.com/users/Stannislav/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Stannislav/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Stannislav/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Stannislav"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "In the logs I see the PostgreSQL error code `57P03`, which according to [the docs](https://www.postgresql.org/docs/current/errcodes-appendix.html) means \"Cannot connect now\". The error message in the logs is \"the database system is starting up\".\r\n\r\nSo maybe we're trying to run commands before the database has finished initialising?",
            "created_at": "2022-01-12T17:09:42Z",
            "html_url": "https://github.com/BlueBrain/Search/issues/547#issuecomment-1011267872",
            "id": 1011267872,
            "issue_url": "https://api.github.com/repos/BlueBrain/Search/issues/547",
            "node_id": "IC_kwDODu5QYM48Rrkg",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/BlueBrain/Search/issues/comments/1011267872/reactions"
            },
            "updated_at": "2022-01-12T17:09:42Z",
            "url": "https://api.github.com/repos/BlueBrain/Search/issues/comments/1011267872",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8017698?v=4",
                "events_url": "https://api.github.com/users/Stannislav/events{/privacy}",
                "followers_url": "https://api.github.com/users/Stannislav/followers",
                "following_url": "https://api.github.com/users/Stannislav/following{/other_user}",
                "gists_url": "https://api.github.com/users/Stannislav/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Stannislav",
                "id": 8017698,
                "login": "Stannislav",
                "node_id": "MDQ6VXNlcjgwMTc2OTg=",
                "organizations_url": "https://api.github.com/users/Stannislav/orgs",
                "received_events_url": "https://api.github.com/users/Stannislav/received_events",
                "repos_url": "https://api.github.com/users/Stannislav/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Stannislav/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Stannislav/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Stannislav"
            }
        },
        {
            "author_association": "COLLABORATOR",
            "body": "> In the logs I see the PostgreSQL error code `57P03`, which according to [the docs](https://www.postgresql.org/docs/current/errcodes-appendix.html) means \"Cannot connect now\". The error message in the logs is \"the database system is starting up\".\r\n> \r\n> So maybe we're trying to run commands before the database has finished initialising?\r\n\r\nYeh! But the code is supposed to just catch the error and retry in a couple of moments. I guess the problematic code is here\r\nhttps://github.com/BlueBrain/Search/blob/d41611ad516e05b2fe28007659b4f33f3d6ce1a1/tests/integration/test_bbs_database.py#L101-L116\r\n\r\nMy guess is that it just comes down to catching the right exception. As you see above the list is quite long already. However, reading the traceback it seems like `sqlalchemy.exc.ProgrammingError` was raised and we are not catching this one.",
            "created_at": "2022-01-12T17:19:09Z",
            "html_url": "https://github.com/BlueBrain/Search/issues/547#issuecomment-1011276722",
            "id": 1011276722,
            "issue_url": "https://api.github.com/repos/BlueBrain/Search/issues/547",
            "node_id": "IC_kwDODu5QYM48Rtuy",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/BlueBrain/Search/issues/comments/1011276722/reactions"
            },
            "updated_at": "2022-01-12T17:20:56Z",
            "url": "https://api.github.com/repos/BlueBrain/Search/issues/comments/1011276722",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/18519371?v=4",
                "events_url": "https://api.github.com/users/jankrepl/events{/privacy}",
                "followers_url": "https://api.github.com/users/jankrepl/followers",
                "following_url": "https://api.github.com/users/jankrepl/following{/other_user}",
                "gists_url": "https://api.github.com/users/jankrepl/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/jankrepl",
                "id": 18519371,
                "login": "jankrepl",
                "node_id": "MDQ6VXNlcjE4NTE5Mzcx",
                "organizations_url": "https://api.github.com/users/jankrepl/orgs",
                "received_events_url": "https://api.github.com/users/jankrepl/received_events",
                "repos_url": "https://api.github.com/users/jankrepl/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/jankrepl/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/jankrepl/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/jankrepl"
            }
        },
        {
            "author_association": "CONTRIBUTOR",
            "body": "Cool, I guess it should be straightforward to fix now.\r\n\r\nI'm surprised there's no generic way in sqlalchemy to wait for the DB to finish initialising.",
            "created_at": "2022-01-12T17:28:14Z",
            "html_url": "https://github.com/BlueBrain/Search/issues/547#issuecomment-1011284679",
            "id": 1011284679,
            "issue_url": "https://api.github.com/repos/BlueBrain/Search/issues/547",
            "node_id": "IC_kwDODu5QYM48RvrH",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/BlueBrain/Search/issues/comments/1011284679/reactions"
            },
            "updated_at": "2022-01-12T17:28:14Z",
            "url": "https://api.github.com/repos/BlueBrain/Search/issues/comments/1011284679",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8017698?v=4",
                "events_url": "https://api.github.com/users/Stannislav/events{/privacy}",
                "followers_url": "https://api.github.com/users/Stannislav/followers",
                "following_url": "https://api.github.com/users/Stannislav/following{/other_user}",
                "gists_url": "https://api.github.com/users/Stannislav/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Stannislav",
                "id": 8017698,
                "login": "Stannislav",
                "node_id": "MDQ6VXNlcjgwMTc2OTg=",
                "organizations_url": "https://api.github.com/users/Stannislav/orgs",
                "received_events_url": "https://api.github.com/users/Stannislav/received_events",
                "repos_url": "https://api.github.com/users/Stannislav/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Stannislav/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Stannislav/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Stannislav"
            }
        }
    ],
    "comments_url": "https://api.github.com/repos/BlueBrain/Search/issues/547/comments",
    "created_at": "2022-01-12T16:32:20Z",
    "events_url": "https://api.github.com/repos/BlueBrain/Search/issues/547/events",
    "html_url": "https://github.com/BlueBrain/Search/issues/547",
    "id": 1100547260,
    "labels": [
        {
            "color": "d73a4a",
            "default": false,
            "description": "Something isn't working",
            "id": 1938483675,
            "name": "\ud83d\udc1b bug fix",
            "node_id": "MDU6TGFiZWwxOTM4NDgzNjc1",
            "url": "https://api.github.com/repos/BlueBrain/Search/labels/%F0%9F%90%9B%20bug%20fix"
        }
    ],
    "labels_url": "https://api.github.com/repos/BlueBrain/Search/issues/547/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDODu5QYM5BmQS8",
    "number": 547,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/BlueBrain/Search/issues/547/reactions"
    },
    "repository_url": "https://api.github.com/repos/BlueBrain/Search",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/BlueBrain/Search/issues/547/timeline",
    "title": "`tests/integration/test_bbs_database.py::test_bbs_database[postgres]` fails randomly",
    "updated_at": "2022-01-17T12:04:51Z",
    "url": "https://api.github.com/repos/BlueBrain/Search/issues/547",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/18519371?v=4",
        "events_url": "https://api.github.com/users/jankrepl/events{/privacy}",
        "followers_url": "https://api.github.com/users/jankrepl/followers",
        "following_url": "https://api.github.com/users/jankrepl/following{/other_user}",
        "gists_url": "https://api.github.com/users/jankrepl/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/jankrepl",
        "id": 18519371,
        "login": "jankrepl",
        "node_id": "MDQ6VXNlcjE4NTE5Mzcx",
        "organizations_url": "https://api.github.com/users/jankrepl/orgs",
        "received_events_url": "https://api.github.com/users/jankrepl/received_events",
        "repos_url": "https://api.github.com/users/jankrepl/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/jankrepl/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/jankrepl/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/jankrepl"
    }
}