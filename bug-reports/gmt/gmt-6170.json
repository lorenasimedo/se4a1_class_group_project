{
    "active_lock_reason": null,
    "assignee": null,
    "assignees": [],
    "author_association": "NONE",
    "body": "I have made some progress on utilizing x2sys for crossover errors. You may recall, I was having some trouble using x2sys_solve to estimate the best fitting parameters from the crossovers. I have been able to use it with artificial data on internal crossovers. I used the track from my 2011 Langseth cruise and, by sampling existing grids for Arctic Ocean gravity and bathymetry, created a track with negligible crossover errors. I then applied a drift of 1 mGal per day to the sampled gravity and 1 meter per day to the sampled bathymetry and used this file for my crossover analysis.\r\n\r\nUsing x2sys_solve with correction types (specified with -E) constant offset, linear drift with distance, offset plus unit scale correction and linear drift with time (options c, d, t and z). With the first three, I was able to produced corrected data. With the linear time drift option, x2sys_solve accurately estimated the drift, but the output from this process did not work well with x2sys_datalist.\r\n\r\nSo the drift parameters for this case were;\r\n\r\nLangseth-11-210-simple-drift grav 0 1.15732e-05*((time-T))\r\n\u2028Langseth-11-210-simple-drift bthy 0 1.15735e-05*((time-T))\r\n\r\nNote that the time unit was seconds and 1.15735e-05 times 86400 is very nearly one, so the program recovered the same drift slope I used to make the artificial \u201cdata.\u201d\r\n\r\nx2sys_solve also reported the mean and std dev of the data before and after applying these corrections. For gravity;\r\n\r\nx2sys_solve [INFORMATION]: Before correction, mean and st.dev.: -2.11173 11.6417\u2028x2sys_solve [INFORMATION]: After correction, mean and st.dev. : 0.000190399 0.00342762\r\n\r\nFor bathymetry;\r\n\r\nx2sys_solve [INFORMATION]: Before correction, mean and st.dev.: -2.11117 11.6425\u2028x2sys_solve [INFORMATION]: After correction, mean and st.dev. : 0.000798657 0.109874\r\n\r\nThe program x2sys_datalist worked well with three versions of the -E option in x2sys_solve. For the linear time drift option it reported an error.\r\n\r\nx2sys_datalist [INFORMATION]: Your distance unit (e) implies geographic data; -fg has been set.\r\n\u2028x2sys_datalist [ERROR]: X2SYS Correction table (xover-test-2/xover-test-2_corrections.txt) requires a column (time) not present in COE database or auxiliary columns\r\n\r\nIt is not clear what the error refers to. The track file contains time;\r\n\r\n64.000460 191.597291 1315739130.00 -2.34 NaN -29.96\u2028\r\n64.002103 191.597329 1315739160.00 -2.41 NaN -29.97\r\n\u202864.003089 191.597357 1315739179.00 -2.46 NaN -29.97\r\n\u202864.003721 191.597358 1315739190.00 -2.49 NaN -29.98\u2028\r\n64.005347 191.597358 1315739220.00 -2.56 NaN -29.98\r\n\u202864.006358 191.597373 1315739239.00 -2.60 NaN -29.98\r\n\r\nIt is consistent with the .fmt file used to initialize the database.\r\n\r\n# Define file for the Arctic format\r\n#ASCII # File is ASCII\r\n\u2028#GEO # Data are geographic\u2028\r\n#name type NaN NaN-proxy scale offset oformat\r\n\u2028lat a N 0 1 0 %9.6f\u2028\r\nlon a N 0 1 0 %10.6f\r\n\u2028rtime a N 0 1 0 %13.2f\u2028\r\ngrav a N 0 1 0 %6.2f\u2028\r\nmagn a N 0 1 0 %7.2f\u2028\r\nbthy a N 0 1 0 %7.2f\r\n\r\nThe COE file uses time tags, but I don\u2019t think x2sys_datalist should be going back to that;\r\n\r\nTag: xover-test-2\r\nCommand: x2sys_cross Langseth-11-210-simple-drift -Txover-test-2 -Il -Sl1.0 -Su40.0 -Qi -V -Z\r\nlon lat t_1 t_2 dist_1 dist_2 head_1 head_2 vel_1 vel_2 grav_1 grav_2 magn_1 magn_2 bthy_1 bthy_2\r\nLangseth-11-210-simple-drift 0 Langseth-11-210-simple-drift 0 2011-09-11T11:05:30/2011-10-07T05:44:00/7400.09 2011-09-11T11:05:30/2011-10-07T05:44:00/7400.09\r\n\u2028-158.601399 74.505466 2011-09-21T15:01:55 2011-10-02T04:53:50 2911.265730 5666.532446 214.025281 125.403931 11.119070 10.386424 11.826169 22.400000 NaN NaN -868.547607 -857.972286\u2028\r\n-159.467164 74.847982 2011-09-21T19:16:28 2011-10-01T10:33:16 2957.277146 5471.532954 213.377161 306.241110 10.480004 11.025322 -16.238760 -6.599659 NaN NaN -1812.641394 -1803.017391\u2028\r\n-160.402656 74.168602 2011-09-21T00:35:41 2011-10-02T11:35:31 2756.640406 5732.619761 35.554968 126.395127 10.947543 9.647302 39.769840 51.230613 NaN NaN -517.471922 -506.001902\r\n\r\nI have not changed any of the source files during this process, so it seems whatever has come out should be consistent with the calculations in x2sys_solve.\r\n\r\nI have attached these files and my script for doing the solving and correction of the track data. \r\n\r\nI invoke the script below on the command line; /bin/csh COA-correct xover-test-2 T\r\n\r\n#!/bin/csh \r\n\r\nsetenv X2SYS_HOME `pwd`\r\n\r\ngmt set D_FORMAT %.6f TIME_EPOCH 1970-01-01T00:00:00 TIME_UNIT s\r\n\r\nset TAG = $1\r\nset model = $2\r\n\r\nif (-e $TAG/\"$TAG\"_corrections.txt) then\r\n    /bin/rm $TAG/\"$TAG\"_corrections.txt\r\nendif\r\n\r\nif ($model == \"DC\") then\r\n    echo Setting DC shift.\r\n    set F = \"-Fcn\"\r\n    set E = \"-Ec\"\r\nelse if ($model == \"D\") then\r\n    echo Setting scale by track distance.\r\n    set F = \"-Fdcn\"\r\n    set E = \"-Ed\"\r\nelse if ($model == \"T\") then\r\n    echo Setting scale by time along track.\r\n    set F = \"-FTcn\"\r\n    set E = \"-Et\"\r\nelse if ($model == \"S\") then\r\n    echo Setting scale by scaling Z.\r\n    set F = \"-Fzn\"\r\n    set E = \"-Ez\"\r\nelse\r\n    echo \"No correction model $model.\"\r\n    exit\r\nendif\r\n\r\nforeach cruise (`cat $TAG/$TAG.lis | awk '{printf\"%s \",$1}'` )\r\n    gmt x2sys_list -Cgrav -T$TAG $TAG/crossover-files/$cruise.coa.txt -E $F -V > crossovers.grav.txt\r\n\r\n   gmt x2sys_solve crossovers.grav.txt -Cgrav $E -T$TAG -V >> $TAG/\"$TAG\"_corrections.txt\r\n   \r\n   gmt x2sys_list -Cbthy -T$TAG $TAG/crossover-files/$cruise.coa.txt -E $F -V > crossovers.bthy.txt\r\n\r\n   gmt x2sys_solve crossovers.bthy.txt -Cbthy $E -T$TAG -V >> $TAG/\"$TAG\"_corrections.txt\r\n   \r\n   gmt x2sys_datalist $cruise -T$TAG -L$TAG/\"$TAG\"_corrections.txt -Vd > $cruise.corr.trk\r\nend\r\n\r\nI include here the full output from x2sys_datalist using the -Vd option.\r\n\r\ngmt [DEBUG]: Obtained the ppid from parent: 56869\r\ngmt [DEBUG]: Enter: gmtinit_new_GMT_ctrl\r\ngmt [DEBUG]: GMT->session.SHAREDIR = /opt/homebrew/Cellar/gmt/6.2.0_1/share/gmt\r\ngmt [DEBUG]: GMT->session.HOMEDIR = /Users/Bernard Coakley\r\ngmt [DEBUG]: GMT->session.USERDIR = /Users/Bernard Coakley/.gmt [created]\r\ngmt [DEBUG]: GMT->session.CACHEDIR = /Users/Bernard Coakley/.gmt/cache [created]\r\ngmt [DEBUG]: GMT: 0. Will try to find subdir=postscriptlight stem = PSL_custom_fonts suffix=.txt\r\ngmt [DEBUG]: GMT: 1. gmt_getsharepath trying current dir\r\ngmt [DEBUG]: GMT: 2. gmt_getsharepath trying USERDIR /Users/Bernard Coakley/.gmt\r\ngmt [DEBUG]: GMT: 3. gmt_getsharepath trying USERDIR subdir /Users/Bernard Coakley/.gmt/postscriptlight\r\ngmt [DEBUG]: GMT: 4. gmt_getsharepath trying SHAREDIR subdir /opt/homebrew/Cellar/gmt/6.2.0_1/share/gmt/postscriptlight\r\ngmt [DEBUG]: GMT: 5. gmt_getsharepath trying SHAREDIR /opt/homebrew/Cellar/gmt/6.2.0_1/share/gmt\r\ngmt [DEBUG]: GMT: 6. gmt_getsharepath failed\r\ngmt [DEBUG]: Map distance calculation will be Cartesian\r\ngmt [DEBUG]: Exit:  gmtinit_new_GMT_ctrl\r\ngmt [DEBUG]: Enter: New_PSL_Ctrl\r\ngmt [DEBUG]: Exit:  New_PSL_Ctrl\r\ngmt [DEBUG]: Enter: gmt_manage_workflow\r\ngmt [DEBUG]: Exit : gmt_manage_workflow\r\ngmt [DEBUG]: Enter: PSL_beginsession\r\ngmt [DEBUG]: Exit : PSL_beginsession\r\ngmt [DEBUG]: Enter: PSL_setdefaults\r\ngmt [DEBUG]: Exit : PSL_setdefaults\r\ngmt [DEBUG]: Enter: gmtlib_io_init\r\ngmt [DEBUG]: Exit : gmtlib_io_init\r\ngmt [DEBUG]: Enter: gmt_hash_init\r\ngmt [DEBUG]: Exit:  gmt_hash_init\r\ngmt [DEBUG]: Enter: gmt_hash_init\r\ngmt [DEBUG]: Exit:  gmt_hash_init\r\ngmt [DEBUG]: Enter: gmt_reload_settings\r\ngmt [DEBUG]: The PROJ_GEODESIC set to Vincenty\r\ngmt [DEBUG]: Found file gmt.conf\r\ngmt [DEBUG]: Reading GMT Default parameters from file: gmt.conf\r\ngmt [DEBUG]: Exit:  gmt_reload_settings\r\ngmt [DEBUG]: Enter: gmtlib_plot_C_format\r\ngmt [DEBUG]: Exit:  gmtlib_plot_C_format\r\ngmt [DEBUG]: Enter: gmtinit_get_history\r\ngmt [DEBUG]: Initialize FFTW with 8 threads.\r\ngmt [DEBUG]: GMT_Create_Session initialized GMT structure\r\ngmt [DEBUG]: Loading core GMT shared library: libgmt.dylib\r\ngmt [DEBUG]: Shared Library # 0 (core). Path = libgmt.dylib\r\ngmt [DEBUG]: Loading GMT plugins from: /opt/homebrew/Cellar/gmt/6.2.0_1/lib/gmt/plugins\r\ngmt [DEBUG]: Shared Library # 1 (supplements). Path = /opt/homebrew/Cellar/gmt/6.2.0_1/lib/gmt/plugins/supplements.so\r\ngmt [DEBUG]: Revised options: Langseth-11-210-simple-drift -Txover-test-2 -Lxover-test-2/xover-test-2_corrections.txt -Vd\r\nx2sys_datalist [DEBUG]: Found readable file xover-test-2/xover-test-2_corrections.txt\r\nx2sys_datalist [DEBUG]: Replace file xover-test-2/xover-test-2_corrections.txt with path xover-test-2/xover-test-2_corrections.txt\r\nx2sys_datalist [DEBUG]: Replace file xover-test-2/xover-test-2_corrections.txt with xover-test-2/xover-test-2_corrections.txt\r\nx2sys_datalist [DEBUG]: Map distance calculation will be using great circle approximation with authalic auxiliary latitudes and authalic (R_2) radius = 6371007.1809 m, in meter.\r\nx2sys_datalist [DEBUG]: Look for file 0/360/-90/90 in /Users/Bernard Coakley/.gmt\r\nx2sys_datalist [DEBUG]: Look for file 0/360/-90/90 in /Users/Bernard Coakley/.gmt/cache\r\nx2sys_datalist [DEBUG]: Look for file 0/360/-90/90 in /Users/Bernard Coakley/.gmt/server\r\nx2sys_datalist [DEBUG]: Got regular w/e/s/n for region (0/360/-90/90)\r\nx2sys_datalist [DEBUG]: Map distance calculation will be using great circle approximation with authalic auxiliary latitudes and authalic (R_2) radius = 6371007.1809 m, in meter.\r\nx2sys_datalist [INFORMATION]: Your distance unit (e) implies geographic data; -fg has been set.\r\nx2sys_datalist [DEBUG]: Map distance calculation will be using great circle approximation with authalic auxiliary latitudes and authalic (R_2) radius = 6371007.1809 m, in meter.\r\nx2sys_datalist [DEBUG]: Found readable file xover-test-2/xover-test-2_corrections.txt\r\nx2sys_datalist [DEBUG]: Calling nc_open on xover-test-2/xover-test-2_corrections.txt, ncid = 0, err = -51\r\nx2sys_datalist [DEBUG]: Found readable file xover-test-2/xover-test-2_corrections.txt\r\nx2sys_datalist [ERROR]: X2SYS Correction table (xover-test-2/xover-test-2_corrections.txt) requires a column (time) not present in COE database or auxiliary columns\r\nx2sys_datalist (x2sys_free_list): tried to free unallocated memory\r\n\r\nExpected outcome would be track data corrected with the drift parameters estimated by x2sys_solve. No file was written.\r\n\r\nSystem information\r\nMac OS Monterrey 12.0.1\r\nGMT version 6.2\r\n\r\nNote; I added .txt to the trk and fmt files so they would be accepted.\r\n[crossovers.grav.txt](https://github.com/GenericMappingTools/gmt/files/7791206/crossovers.grav.txt)\r\n[crossovers.bthy.txt](https://github.com/GenericMappingTools/gmt/files/7791207/crossovers.bthy.txt)\r\n[xover-test-2.fmt.txt](https://github.com/GenericMappingTools/gmt/files/7791208/xover-test-2.fmt.txt)\r\n[Langseth-11-210-simple-drift.trk.txt](https://github.com/GenericMappingTools/gmt/files/7791209/Langseth-11-210-simple-drift.trk.txt)\r\n[Langseth-11-210-simple-drift.coa.txt](https://github.com/GenericMappingTools/gmt/files/7791212/Langseth-11-210-simple-drift.coa.txt)\r\n\r\n",
    "closed_at": "2022-04-04T21:03:30Z",
    "closed_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/26473567?v=4",
        "events_url": "https://api.github.com/users/PaulWessel/events{/privacy}",
        "followers_url": "https://api.github.com/users/PaulWessel/followers",
        "following_url": "https://api.github.com/users/PaulWessel/following{/other_user}",
        "gists_url": "https://api.github.com/users/PaulWessel/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/PaulWessel",
        "id": 26473567,
        "login": "PaulWessel",
        "node_id": "MDQ6VXNlcjI2NDczNTY3",
        "organizations_url": "https://api.github.com/users/PaulWessel/orgs",
        "received_events_url": "https://api.github.com/users/PaulWessel/received_events",
        "repos_url": "https://api.github.com/users/PaulWessel/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/PaulWessel/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/PaulWessel/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/PaulWessel"
    },
    "comments": 2,
    "comments_content": [
        {
            "author_association": "MEMBER",
            "body": "Hi @bjcoakley, sorry for the extreme tardiness (nothing new I know).  I am not at Oxford and hopefully I can carve out a weekend to go over all of this.",
            "created_at": "2022-03-03T08:50:51Z",
            "html_url": "https://github.com/GenericMappingTools/gmt/issues/6170#issuecomment-1057813845",
            "id": 1057813845,
            "issue_url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/6170",
            "node_id": "IC_kwDOCJzWHc4_DPVV",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/comments/1057813845/reactions"
            },
            "updated_at": "2022-03-03T08:50:51Z",
            "url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/comments/1057813845",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/26473567?v=4",
                "events_url": "https://api.github.com/users/PaulWessel/events{/privacy}",
                "followers_url": "https://api.github.com/users/PaulWessel/followers",
                "following_url": "https://api.github.com/users/PaulWessel/following{/other_user}",
                "gists_url": "https://api.github.com/users/PaulWessel/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/PaulWessel",
                "id": 26473567,
                "login": "PaulWessel",
                "node_id": "MDQ6VXNlcjI2NDczNTY3",
                "organizations_url": "https://api.github.com/users/PaulWessel/orgs",
                "received_events_url": "https://api.github.com/users/PaulWessel/received_events",
                "repos_url": "https://api.github.com/users/PaulWessel/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/PaulWessel/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/PaulWessel/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/PaulWessel"
            }
        },
        {
            "author_association": "NONE",
            "body": "No worries. Let me know if you need anything else.",
            "created_at": "2022-03-03T19:02:28Z",
            "html_url": "https://github.com/GenericMappingTools/gmt/issues/6170#issuecomment-1058387237",
            "id": 1058387237,
            "issue_url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/6170",
            "node_id": "IC_kwDOCJzWHc4_FbUl",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/comments/1058387237/reactions"
            },
            "updated_at": "2022-03-03T19:02:28Z",
            "url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/comments/1058387237",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/48657958?v=4",
                "events_url": "https://api.github.com/users/bjcoakley/events{/privacy}",
                "followers_url": "https://api.github.com/users/bjcoakley/followers",
                "following_url": "https://api.github.com/users/bjcoakley/following{/other_user}",
                "gists_url": "https://api.github.com/users/bjcoakley/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/bjcoakley",
                "id": 48657958,
                "login": "bjcoakley",
                "node_id": "MDQ6VXNlcjQ4NjU3OTU4",
                "organizations_url": "https://api.github.com/users/bjcoakley/orgs",
                "received_events_url": "https://api.github.com/users/bjcoakley/received_events",
                "repos_url": "https://api.github.com/users/bjcoakley/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/bjcoakley/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/bjcoakley/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/bjcoakley"
            }
        }
    ],
    "comments_url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/6170/comments",
    "created_at": "2021-12-30T01:54:36Z",
    "events_url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/6170/events",
    "html_url": "https://github.com/GenericMappingTools/gmt/issues/6170",
    "id": 1090828758,
    "labels": [
        {
            "color": "d73a4a",
            "default": true,
            "description": "Something isn't working",
            "id": 1022239695,
            "name": "bug",
            "node_id": "MDU6TGFiZWwxMDIyMjM5Njk1",
            "url": "https://api.github.com/repos/GenericMappingTools/gmt/labels/bug"
        }
    ],
    "labels_url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/6170/labels{/name}",
    "locked": false,
    "milestone": null,
    "node_id": "I_kwDOCJzWHc5BBLnW",
    "number": 6170,
    "performed_via_github_app": null,
    "reactions": {
        "+1": 0,
        "-1": 0,
        "confused": 0,
        "eyes": 0,
        "heart": 0,
        "hooray": 0,
        "laugh": 0,
        "rocket": 0,
        "total_count": 0,
        "url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/6170/reactions"
    },
    "repository_url": "https://api.github.com/repos/GenericMappingTools/gmt",
    "state": "closed",
    "state_reason": "completed",
    "timeline_url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/6170/timeline",
    "title": "unexpected behavior by x2sys_datalist",
    "updated_at": "2022-04-04T21:03:30Z",
    "url": "https://api.github.com/repos/GenericMappingTools/gmt/issues/6170",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/48657958?v=4",
        "events_url": "https://api.github.com/users/bjcoakley/events{/privacy}",
        "followers_url": "https://api.github.com/users/bjcoakley/followers",
        "following_url": "https://api.github.com/users/bjcoakley/following{/other_user}",
        "gists_url": "https://api.github.com/users/bjcoakley/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/bjcoakley",
        "id": 48657958,
        "login": "bjcoakley",
        "node_id": "MDQ6VXNlcjQ4NjU3OTU4",
        "organizations_url": "https://api.github.com/users/bjcoakley/orgs",
        "received_events_url": "https://api.github.com/users/bjcoakley/received_events",
        "repos_url": "https://api.github.com/users/bjcoakley/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/bjcoakley/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/bjcoakley/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/bjcoakley"
    }
}